(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{495:function(t,a,n){"use strict";n.r(a);var s=n(2),e=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("平时我们比较推崇的性能监测方案主要有两种："),a("strong",[t._v("可视化方案、可编程方案")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"可视化监测-performance面板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可视化监测-performance面板"}},[t._v("#")]),t._v(" 可视化监测：Performance面板")]),t._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://user-gold-cdn.xitu.io/2018/10/7/1664d6a13652f0db?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}}),t._v(" "),a("p",[t._v("当我们选中图中所标示的实心圆按钮，Performance 会开始帮我们记录我们后续的交互操作；当我们选中圆箭头按钮，Performance 会将页面重新加载，计算加载过程中的性能表现。")]),t._v(" "),a("blockquote",[a("p",[t._v("tips：使用 Performance 工具时，为了规避其它 Chrome 插件对页面的性能影响，我们最好在无痕模式下打开页面：")])]),t._v(" "),a("p",[t._v("就拿掘金的页面来举例子看看性能如何:")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/image-20210218150100279.png",alt:"image-20210218150100279"}})]),t._v(" "),a("p",[t._v("从上到下，依次为概述面板、详情面板。下我们先来观察一下概述面板，了解页面的基本表现：")]),t._v(" "),a("p",[t._v("我们看右上角的三个栏目：FPS、CPU 和 NET。")]),t._v(" "),a("p",[a("strong",[t._v("FPS")]),t._v("：这是一个和动画性能密切相关的指标，它表示每一秒的帧数。图中绿色柱状越高表示帧率越高，体验就越流畅。若出现红色块，则代表长时间帧，很可能会出现卡顿。图中以绿色为主，偶尔出现红块，说明网页性能并不糟糕，但仍有可优化的空间。")]),t._v(" "),a("p",[a("strong",[t._v("CPU")]),t._v("：表示CPU的使用情况，不同的颜色片段代表着消耗CPU资源的不同事件类型。这部分的图像和下文详情面板中的Summary内容有对应关系，我们可以结合这两者挖掘性能瓶颈。")]),t._v(" "),a("p",[a("strong",[t._v("NET")]),t._v("：粗略的展示了各请求的耗时与前后顺序。这个指标一般来说帮助不大。")]),t._v(" "),a("p",[a("strong",[t._v("我们可以清晰的看到")])]),t._v(" "),a("p",[t._v("CPU 图表中，我们可以根据颜色填充的饱满程度，确定 CPU 的忙闲，进而了解该页面的总的任务量。而 Summary 饼图则以一种直观的方式告诉了我们，哪个类型的任务最耗时（从本例来看是脚本执行过程）")]),t._v(" "),a("p",[t._v("Main 提供给我们的火焰图。它展示了整个运行时主进程所做的每一件事情（包括加载、脚本运行、渲染、布局、绘制等）。x 轴表示随时间的记录。每个长条就代表一个活动。更宽的条形意味着事件需要更长时间。y 轴表示调用堆栈，我们可以看到事件是相互堆叠的，上层的事件触发了下层的事件。")]),t._v(" "),a("h2",{attrs:{id:"可视化监测-lighthouse"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可视化监测-lighthouse"}},[t._v("#")]),t._v(" 可视化监测： LightHouse")]),t._v(" "),a("blockquote",[a("p",[t._v("Lighthouse 是一个开源的自动化工具，用于改进网络应用的质量。 你可以将其作为一个 Chrome 扩展程序运行，或从命令行运行。 为Lighthouse 提供一个需要审查的网址，它将针对此页面运行一连串的测试，然后生成一个有关页面性能的报告。")])]),t._v(" "),a("img",{attrs:{src:"/img/image-20210218150640945.png",alt:"image-20210218150640945"}}),t._v(" "),a("p",[t._v("上述分别是页面性能、可访问性（无障碍）、最佳实践、SEO、PWA（渐进式 Web 应用） 五项指标的跑分。孰强孰弱，我们一看便知。")]),t._v(" "),a("h2",{attrs:{id:"可编程的性能上报方案-w3c-性能-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可编程的性能上报方案-w3c-性能-api"}},[t._v("#")]),t._v(" 可编程的性能上报方案： W3C 性能 API")]),t._v(" "),a("p",[t._v("W3C 规范为我们提供了 Performance 相关的接口。它允许我们获取到用户访问一个页面的每个阶段的精确时间，从而对性能进行分析。我们可以将其理解为 Performance 面板的进一步细化与可编程化。")]),t._v(" "),a("h3",{attrs:{id:"访问-performance-对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问-performance-对象"}},[t._v("#")]),t._v(" 访问 performance 对象")]),t._v(" "),a("p",[t._v("performance 是一个全局对象。我们在控制台里输入 "),a("code",[t._v("window.performance")]),t._v("，就可一窥其全貌")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/web-perf.jpg",alt:"image-20210218150935575"}})]),t._v(" "),a("h3",{attrs:{id:"关键时间节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键时间节点"}},[t._v("#")]),t._v(" 关键时间节点")]),t._v(" "),a("p",[t._v("在 performance 的 timing 属性中，我们可以查看到如下的时间戳：")]),t._v(" "),a("img",{staticStyle:{zoom:"120%"},attrs:{src:"/img/image-20210218151017674.png",alt:"image-20210218151017674"}}),t._v(" "),a("p",[t._v("下面分别介绍timing对象的各个属性:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("navigationStart")]),t._v(":开始导航到当前页面的时间，即在地址栏输入地址后按下回车时的时间")]),t._v(" "),a("li",[a("code",[t._v("unloadEventStart")]),t._v(":前一个页面的unload事件开始的时间。但只有在前一个页面与当前页面来自同一个域时这个属性才会有值；否则，值为0")]),t._v(" "),a("li",[a("code",[t._v("unloadEventEnd")]),t._v(":前一个页面的unload事件结束的时间。但只有在前一个页面与当前页面来自同一个域时这个属性才会有值；否则，值为0")]),t._v(" "),a("li",[a("code",[t._v("redirectStart")]),t._v(":到当前页面的重定向开始的时间。但只有在重定向的页面来自同一个域时这个属性才会有值；否则，值为0")]),t._v(" "),a("li",[a("code",[t._v("redirectEnd")]),t._v(":到当前页面的重定向结束的时间。但只有在重定向的页面来自同一个域时这个属性才会有值；否则，值为0")]),t._v(" "),a("li",[a("code",[t._v("fetchStart")]),t._v(":开始通过HTTP GET取得页面的时间")]),t._v(" "),a("li",[a("code",[t._v("domainLookupStart")]),t._v(":开始査询当前页面"),a("code",[t._v("DNS")]),t._v("的时间，如果使用了本地缓存或持久连接，则与"),a("code",[t._v("fetchStart")]),t._v("值相等")]),t._v(" "),a("li",[a("code",[t._v("domainLookupEnd")]),t._v(":査询当前页面"),a("code",[t._v("DNS")]),t._v("结束的时间，如果使用了本地缓存或持久连接，则与"),a("code",[t._v("fetchStart")]),t._v("值相等")]),t._v(" "),a("li",[a("code",[t._v("connectStart")]),t._v(":浏览器尝试连接服务器的时间")]),t._v(" "),a("li",[a("code",[t._v("connectEnd")]),t._v(":浏览器成功连接到服务器的时间")]),t._v(" "),a("li",[a("code",[t._v("secureConnectionStart")]),t._v(":浏览器尝试以SSL方式连接服务器的时间。不使用SSL方式连接时，这个属性的值为0")]),t._v(" "),a("li",[a("code",[t._v("requestStart")]),t._v(":浏览器开始请求页面的时间")]),t._v(" "),a("li",[a("code",[t._v("responseStart")]),t._v(":浏览器接收到页面第一字节的时间")]),t._v(" "),a("li",[a("code",[t._v("responseEnd")]),t._v(":浏览器接收到页面所有内容的时间")]),t._v(" "),a("li",[a("code",[t._v("domLoading")]),t._v(':document.readyState变为"loading"的时间，即开始解析DOM树的时间')]),t._v(" "),a("li",[a("code",[t._v("domInteractive")]),t._v(':document.readyState变为"interactive"的时间，即完成完成解析DOM树的时间')]),t._v(" "),a("li",[a("code",[t._v("domContentLoadedEventStart")]),t._v(":发生DOMContentloaded事件的时间，即开始加载网页内资源的时间")]),t._v(" "),a("li",[a("code",[t._v("domContentLoadedEventEnd")]),t._v(":DOMContentLoaded事件已经发生且执行完所有事件处理程序的时间，网页内资源加载完成的时间")]),t._v(" "),a("li",[a("code",[t._v("domComplete")]),t._v(':document.readyState变为"complete"的时间，即DOM树解析完成、网页内资源准备就绪的时间')]),t._v(" "),a("li",[a("code",[t._v("loadEventStart")]),t._v(":发生load事件的时间，也就是load回调函数开始执行的时间")]),t._v(" "),a("li",[a("code",[t._v("loadEventEnd")]),t._v(":load事件已经发生且执行完所有事件处理程序的时间")])]),t._v(" "),a("p",[t._v("这些时间戳与页面整个加载流程中的关键时间节点有着一一对应的关系：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/10/7/1664ddd4e3df9a14?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/timestamp-diagram.svg",alt:"img"}})]),t._v(" "),a("p",[t._v("上图的过程大致可以分为三个大的阶段：")]),t._v(" "),a("ol",[a("li",[t._v("缓存相关：主要包括Prompt for unload,redirect和App cache 3个过程")]),t._v(" "),a("li",[t._v("网络相关：主要包括DNS,TCP和HTTP(Request,Response) 3个过程")]),t._v(" "),a("li",[t._v("浏览器相关：主要包括Processing和onload两个过程")])]),t._v(" "),a("p",[t._v("通过求两个时间点之间的差值，我们可以得出某个过程花费的时间,举个例子:")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" timing "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timing\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//重定向时间")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redirectEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redirectStart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DNS查询耗时")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domainLookupEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domainLookupStart\n  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TCP连接耗时")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connectEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connectStart\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 内容加载耗时（Http响应时间）")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requestStart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DOM加载完成时间")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domComplete "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domLoading\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//脚本加载时间")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domContentLoadedEventEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domContentLoadedEventStart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//onload事件时间")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loadEventEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loadEventStart\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br")])]),a("p",[t._v("除了这些常见的耗时情况，我们更应该去关注一些"),a("strong",[t._v("关键性能指标")]),t._v("：firstbyte、fpt、tti、ready 和 load 时间。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// firstbyte：首包时间\t")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseStart – timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domainLookupStart\t\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fpt：First Paint Time, 首次渲染时间 / 白屏时间")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseEnd – timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchStart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// tti：Time to Interact，首次可交互时间\t")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domInteractive – timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchStart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ready：HTML 加载完成时间，即 DOM 就位的时间")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domContentLoaded – timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchStart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// load：页面完全加载时间")]),t._v("\ntiming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loadEventStart – timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchStart\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);