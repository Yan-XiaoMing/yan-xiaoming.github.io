(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{475:function(t,r,s){"use strict";s.r(r);var e=s(2),a=Object(e.a)({},(function(){var t=this,r=t._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("blockquote",[r("p",[t._v("问: 既然 Https 那么安全，那为什么用抓包工具还是可以看到里面的数据？")])]),t._v(" "),r("p",[t._v("下面对 HTTPS 的抓包的过程原理做一个简单的介绍。")]),t._v(" "),r("h2",{attrs:{id:"抓包的原理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#抓包的原理"}},[t._v("#")]),t._v(" 抓包的原理")]),t._v(" "),r("p",[r("strong",[t._v("抓包")]),t._v("，其实就是"),r("strong",[t._v("中间人攻击")]),t._v("，在网络请求过程中，抓包工具充当着客户端/服务端的角色，当客户端请求数据时，抓包工具将请求进行拦截，然后构造数据（冒充客户端）向服务端发起请求，此时服务端会返回自己的公钥证书，然后抓包工具将服务端的公钥证书替换成自己的公钥证书，随后将数据返回可客户端（此时充当服务端的角色）。")]),t._v(" "),r("p",[r("strong",[t._v("客户端")]),t._v("拿到公钥证书后，使用公钥证书中的公钥对 Pre-master secret 进行加密，并发送给"),r("strong",[t._v("服务端")]),t._v("，发送过程中又被抓包工具拦截，由于客户端使用的公钥其实就是抓包工具生成的证书公钥，所以抓包工具只需要使用自己的私钥进行解密即可拿到真实的 Pre-master secret（因为抓包工具在之前的过程中已经拿到了双方的随机码，所以到这一步抓包工具相当于已经拿到了后续通信使用的密钥），随后抓包工具使用从服务端接收到的公钥证书中的公钥对 Pre-master secret 进行加密，然后发送给服务端。随后的通信过程虽然进行了加密，但抓包工具已经生成了密钥（master secret），所以可以查看 Https 的通信内容。")]),t._v(" "),r("p",[t._v("从抓包的原理可以看出，对 Https 进行抓包，需要 PC 端和手机端同时安装证书。")]),t._v(" "),r("blockquote",[r("p",[r("strong",[t._v("总结:")]),t._v(" 能抓包，那是因为你信任抓包工具")])]),t._v(" "),r("h2",{attrs:{id:"如何避免被抓包"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#如何避免被抓包"}},[t._v("#")]),t._v(" 如何避免被抓包")]),t._v(" "),r("p",[t._v("既然使用了 Https 协议，就是不想让别人看到数据，那如何避免被抓包呢？这里有 2 种方法可参考：")]),t._v(" "),r("ul",[r("li",[t._v("使用自定义协议；")]),t._v(" "),r("li",[t._v("使用 SSL Pinning;")])]),t._v(" "),r("h3",{attrs:{id:"使用-tcp-协议"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#使用-tcp-协议"}},[t._v("#")]),t._v(" 使用 TCP 协议")]),t._v(" "),r("p",[t._v("使用自定义协议，也就是以 TCP/UDP 为基础，使用 Socket 进行通信（具体可参考"),r("a",{attrs:{href:"https://juejin.im/post/6844903548862513159",target:"_blank",rel:"noopener noreferrer"}},[t._v("网络编程之理论篇"),r("OutboundLink")],1),t._v("），这种方式由于不是使用的 Http/Https 协议，所以可避免 Http 类型的抓包工具（如 Charles, Fiddler）进行抓包, 但不可避免 WireShark，毕竟它太强大，可抓取网络模型中各层的数据。")]),t._v(" "),r("h3",{attrs:{id:"使用-ssl-pinning"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#使用-ssl-pinning"}},[t._v("#")]),t._v(" 使用 SSL Pinning")]),t._v(" "),r("p",[t._v("看着很陌生，其实也不是啥新技术，只需要将服务端的公钥证书一起打到 APK 中，在网络请求时，与服务端的公钥证书进行比较，即可避免抓包工具使用构造证书进行抓包的情况。")])])}),[],!1,null,null,null);r.default=a.exports}}]);